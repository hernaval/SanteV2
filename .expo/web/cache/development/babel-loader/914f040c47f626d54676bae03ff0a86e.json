{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"C:\\\\Users\\\\Stenny Gabriel\\\\best4sante\\\\Best4Sante\\\\assets\\\\Helpers\\\\requireAuth.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport AsyncStorage from \"react-native-web/dist/exports/AsyncStorage\";\nimport { setUserInfo, setContactInfo, setFavoriteInfo, setSecondInfo } from \"../Action\";\nimport { connect } from \"react-redux\";\nimport axios from \"axios\";\nimport config from \"../API/Bdd\";\nimport * as TaskManager from 'expo-task-manager';\nimport * as Location from 'expo-location';\nexport default function (ChildComponent) {\n  var RequireAuthentification = function (_Component) {\n    _inherits(RequireAuthentification, _Component);\n\n    var _super = _createSuper(RequireAuthentification);\n\n    function RequireAuthentification(props) {\n      var _this;\n\n      _classCallCheck(this, RequireAuthentification);\n\n      _this = _super.call(this, props);\n\n      _this._retrieveData = function _callee2(key) {\n        var token;\n        return _regeneratorRuntime.async(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return _regeneratorRuntime.awrap(AsyncStorage.getItem(key));\n\n              case 3:\n                token = _context2.sent;\n\n                if (token !== null) {\n                  axios.get(config.api_url + '/api/checkToken', {\n                    headers: {\n                      'x-access-token': token\n                    }\n                  }).then(function (res) {\n                    if (res.data.status !== 200) {\n                      _this.props.navigation.push(\"Login\");\n                    } else {\n                      if (_this.props.user.user === null) {\n                        _this.props.setUserInfo(token);\n\n                        axios.get(config.api_url + '/api/user/userToken', {\n                          headers: {\n                            'x-access-token': token\n                          }\n                        }).then(function _callee(user) {\n                          return _regeneratorRuntime.async(function _callee$(_context) {\n                            while (1) {\n                              switch (_context.prev = _context.next) {\n                                case 0:\n                                  console.log('user dans require', user.data.user[0].email);\n\n                                  _this.props.setContactInfo(user.data.user[0].id);\n\n                                  _this.props.setFavoriteInfo(user.data.user[0].id);\n\n                                  _this.props.setSecondInfo(token, user.data.user[0].id);\n\n                                case 4:\n                                case \"end\":\n                                  return _context.stop();\n                              }\n                            }\n                          }, null, null, null, Promise);\n                        }).catch(function (err) {\n                          console.log(err);\n                        });\n                      }\n                    }\n                  }).catch(function (err) {\n                    console.log(err);\n                  });\n                } else {\n                  _this.props.navigation.navigate(\"Login\");\n                }\n\n                _context2.next = 10;\n                break;\n\n              case 7:\n                _context2.prev = 7;\n                _context2.t0 = _context2[\"catch\"](0);\n                console.log(_context2.t0);\n\n              case 10:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, null, null, [[0, 7]], Promise);\n      };\n\n      return _this;\n    }\n\n    _createClass(RequireAuthentification, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        this._retrieveData('bosToken');\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        return React.createElement(ChildComponent, {\n          navigation: this.props.navigation,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 14\n          }\n        });\n      }\n    }]);\n\n    return RequireAuthentification;\n  }(Component);\n\n  var mapStateToProps = function mapStateToProps(store) {\n    return {\n      user: store.user,\n      contact: store.contact,\n      favorite: store.favorite,\n      second: store.second\n    };\n  };\n\n  var mapDispatchToProps = {\n    setUserInfo: setUserInfo,\n    setContactInfo: setContactInfo,\n    setFavoriteInfo: setFavoriteInfo,\n    setSecondInfo: setSecondInfo\n  };\n  return connect(mapStateToProps, mapDispatchToProps)(RequireAuthentification);\n}","map":{"version":3,"sources":["C:/Users/Stenny Gabriel/best4sante/Best4Sante/assets/Helpers/requireAuth.js"],"names":["React","Component","setUserInfo","setContactInfo","setFavoriteInfo","setSecondInfo","connect","axios","config","TaskManager","Location","ChildComponent","RequireAuthentification","props","_retrieveData","key","AsyncStorage","getItem","token","get","api_url","headers","then","res","data","status","navigation","push","user","console","log","email","id","catch","err","navigate","mapStateToProps","store","contact","favorite","second","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { StyleSheet, Text, View, TextInput, AsyncStorage } from 'react-native';\r\nimport {setUserInfo, setContactInfo, setFavoriteInfo, setSecondInfo} from '../Action'\r\nimport { connect } from \"react-redux\";\r\nimport \taxios from \"axios\";\r\nimport config from '../API/Bdd'\r\nimport * as TaskManager from 'expo-task-manager';\r\nimport * as Location from 'expo-location';\r\n\r\n\r\nexport default function(ChildComponent) {\r\n\tclass RequireAuthentification extends Component {\r\n\r\n\t\tconstructor(props) {\r\n\t\t\tsuper(props);\r\n\t\t\t\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\tcomponentDidMount() {\r\n\t\t\tthis._retrieveData('bosToken');\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\t_retrieveData = async (key) => {\r\n\t\t\ttry {\r\n\t\t\t  const token = await AsyncStorage.getItem(key);\r\n\t\t\t\r\n\t\t\t  if (token !== null) {\r\n\t\t\t\t// We have data!!\r\n\t\t\t\taxios.get(config.api_url+'/api/checkToken',{ headers: { 'x-access-token': token }} )\r\n\t\t\t\t.then((res)=>{\r\n\t\t\t\t\r\n\t\t\t\t\tif(res.data.status !== 200) {\r\n\t\t\t\t\t\tthis.props.navigation.push(\"Login\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(this.props.user.user === null) {\r\n\t\t\t\t\t\t\tthis.props.setUserInfo(token)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\taxios.get(config.api_url+'/api/user/userToken',{ headers: { 'x-access-token': token }} )\r\n\t\t\t\t\t\t\t.then(async (user)=>{\r\n\t\t\t\t\t\t\t\tconsole.log('user dans require',user.data.user[0].email);\r\n\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\tthis.props.setContactInfo(user.data.user[0].id);\r\n\t\t\t\t\t\t\t\tthis.props.setFavoriteInfo(user.data.user[0].id)\r\n\t\t\t\t\t\t\t\tthis.props.setSecondInfo(token, user.data.user[0].id)\r\n\r\n\t\t\t\t\t\t\t\t// if(user.data.user[0].geo_auth === 1) {\r\n\t\t\t\t\t\t\t\t// \tconst { status } = await Location.requestPermissionsAsync();\r\n\t\t\t\t\t\t\t\t// \tif (status === 'granted') {\r\n\t\t\t\t\t\t\t\t// \t\tawait Location.startLocationUpdatesAsync('geoloc_bakground', {\r\n\t\t\t\t\t\t\t\t// \t\t\taccuracy: Location.Accuracy.Balanced,\r\n\t\t\t\t\t\t\t\t// \t\t\tdistanceInterval: 100\r\n\t\t\t\t\t\t\t\t// \t\t});\r\n\t\t\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t\t\t// }\r\n\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.catch((err)=>{\r\n\t\t\t\t\t\t\t\tconsole.log(err)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch((err)=>{\r\n\t\t\t\t\tconsole.log(err)\r\n\t\t\t\t})\r\n\t\t\t  } else {\r\n\t\t\t\tthis.props.navigation.navigate(\"Login\");\r\n\t\t\t   \r\n\t\t\t  }\r\n\t\t\t} catch (error) {\r\n\t\t\t  // Error retrieving data\r\n\t\t\t  console.log(error);\r\n\t\t\t}\r\n\t\t  }\r\n\t\t\r\n\r\n\t    render() {\r\n\t    \treturn <ChildComponent navigation={this.props.navigation}/>\r\n\t    }\r\n\t}\r\n\r\n\tconst mapStateToProps = (store) => {\r\n\t\treturn {\r\n\t\t\tuser: store.user,\r\n\t\t\tcontact: store.contact,\r\n\t\t\tfavorite: store.favorite,\r\n\t\t\tsecond: store.second\r\n\t\t}\r\n\t}\r\n\r\n\tconst mapDispatchToProps = {\r\n\t\tsetUserInfo,\r\n\t\tsetContactInfo,\r\n\t\tsetFavoriteInfo,\r\n\t\tsetSecondInfo\r\n\t}\r\n\r\n\t// TaskManager.defineTask('geoloc_bakground', ({ data, error }) => {\r\n\t// \tif (error) {\r\n\t// \t  // Error occurred - check `error.message` for more details.\r\n\t// \t  return;\r\n\t// \t}\r\n\t// \tif (data) {\r\n\t// \t  const { locations } = data;\r\n\t\t  \r\n\t// \t  console.log('first', data);\r\n\t// \t  let coords = {\r\n\t// \t\t  lat: data.locations[0].coords.latitude,\r\n\t// \t\t  lng: data.locations[0].coords.longitude,\r\n\t// \t\t  id: 601\r\n\t// \t  }\r\n\t// \t  // do something with the locations captured in the background\r\n\t// \t  axios.post(config.api_url+\"/api/user/updateGeo\", coords)\r\n\t// \t\t  .then((res)=>{\r\n\t// \t\t\t  console.log(res);\r\n\t// \t\t  })\r\n\t  \r\n\t// \t}\r\n\t// });\r\n\r\n\treturn connect(mapStateToProps, mapDispatchToProps)(RequireAuthentification);\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}