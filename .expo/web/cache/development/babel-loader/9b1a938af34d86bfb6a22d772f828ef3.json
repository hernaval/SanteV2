{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"E:\\\\Projets\\\\Acadys\\\\best4sante\\\\SanteV2\\\\assets\\\\Helpers\\\\requireAuth.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport { AsyncStorage } from \"react-native-web/dist/index\";\nimport { setUserInfo, mySecondProfil, setContactInfo, setFavoriteInfo, setSecondInfo, onlineUser, setAuthentification } from \"../Action\";\nimport { connect } from \"react-redux\";\nimport axios from \"axios\";\nimport Bdd from \"../API/Bdd\";\nimport * as TaskManager from 'expo-task-manager';\nimport * as Location from 'expo-location';\nimport { _setSocket, _emitEvent, onSamaritainListChange, SocketService } from \"../services/socket\";\nimport { getCurrentLocation } from \"../services/location\";\nimport { faUserCircle, faUser } from '@fortawesome/free-solid-svg-icons';\nimport { registerForPushNotificationsAsync } from \"../services/notifications\";\nexport default function (ChildComponent) {\n  var RequireAuthentification = function (_Component) {\n    _inherits(RequireAuthentification, _Component);\n\n    var _super = _createSuper(RequireAuthentification);\n\n    function RequireAuthentification(props) {\n      var _this;\n\n      _classCallCheck(this, RequireAuthentification);\n\n      _this = _super.call(this, props);\n\n      _this._retrieveData = function _callee2(key) {\n        var token;\n        return _regeneratorRuntime.async(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return _regeneratorRuntime.awrap(AsyncStorage.getItem(key));\n\n              case 3:\n                token = _context2.sent;\n\n                if (token !== null) {\n                  axios.get(Bdd.api_url + '/checkToken', {\n                    headers: {\n                      'x-access-token': token\n                    }\n                  }).then(function _callee(res) {\n                    var value, socketListenId, location, coords, socketSrv;\n                    return _regeneratorRuntime.async(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            if (!(res.status !== 200)) {\n                              _context.next = 4;\n                              break;\n                            }\n\n                            _this.props.navigation.push(\"Login\");\n\n                            _context.next = 17;\n                            break;\n\n                          case 4:\n                            value = token;\n                            socketListenId = \"samaritain_\" + value;\n                            _context.next = 8;\n                            return _regeneratorRuntime.awrap(getCurrentLocation());\n\n                          case 8:\n                            location = _context.sent;\n                            coords = {\n                              lat: location.coords.latitude,\n                              log: location.coords.longitude\n                            };\n                            socketSrv = new SocketService(\"samaritain\");\n                            socketSrv.emitEvent(\"status_change\", {\n                              token: value,\n                              socketListenId: socketListenId,\n                              coords: coords,\n                              type: \"join\"\n                            });\n                            _context.next = 14;\n                            return _regeneratorRuntime.awrap(registerForPushNotificationsAsync(value));\n\n                          case 14:\n                            _this.props.setUserInfo(token);\n\n                            _this.props.mySecondProfil(token);\n\n                            _this.props.setAuthentification(true);\n\n                          case 17:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, null, null, null, Promise);\n                  }).catch(function (err) {\n                    console.log(err);\n                  });\n                } else {\n                  _this.props.navigation.navigate(\"Login\");\n                }\n\n                _context2.next = 10;\n                break;\n\n              case 7:\n                _context2.prev = 7;\n                _context2.t0 = _context2[\"catch\"](0);\n                console.log(_context2.t0);\n\n              case 10:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, null, null, [[0, 7]], Promise);\n      };\n\n      return _this;\n    }\n\n    _createClass(RequireAuthentification, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        this._retrieveData('bosToken');\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        return React.createElement(ChildComponent, {\n          navigation: this.props.navigation,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 84,\n            columnNumber: 14\n          }\n        });\n      }\n    }]);\n\n    return RequireAuthentification;\n  }(Component);\n\n  var mapStateToProps = function mapStateToProps(store) {\n    return {\n      user: store.user,\n      contact: store.contact,\n      favorite: store.favorite,\n      second: store.second\n    };\n  };\n\n  var mapDispatchToProps = {\n    setUserInfo: setUserInfo,\n    mySecondProfil: mySecondProfil,\n    setContactInfo: setContactInfo,\n    setFavoriteInfo: setFavoriteInfo,\n    setSecondInfo: setSecondInfo,\n    onlineUser: onlineUser,\n    setAuthentification: setAuthentification\n  };\n  return connect(mapStateToProps, mapDispatchToProps)(RequireAuthentification);\n}","map":{"version":3,"sources":["E:/Projets/Acadys/best4sante/SanteV2/assets/Helpers/requireAuth.js"],"names":["React","Component","AsyncStorage","setUserInfo","mySecondProfil","setContactInfo","setFavoriteInfo","setSecondInfo","onlineUser","setAuthentification","connect","axios","Bdd","TaskManager","Location","_setSocket","_emitEvent","onSamaritainListChange","SocketService","getCurrentLocation","faUserCircle","faUser","registerForPushNotificationsAsync","ChildComponent","RequireAuthentification","props","_retrieveData","key","getItem","token","get","api_url","headers","then","res","status","navigation","push","value","socketListenId","location","coords","lat","latitude","log","longitude","socketSrv","emitEvent","type","catch","err","console","navigate","mapStateToProps","store","user","contact","favorite","second","mapDispatchToProps"],"mappings":";;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;;;;;SAC4CC,Y;AAC5C,SAAQC,WAAR,EAAoBC,cAApB,EAAoCC,cAApC,EAAoDC,eAApD,EAAqEC,aAArE,EAAoFC,UAApF,EAA+FC,mBAA/F;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAQC,KAAR,MAAmB,OAAnB;AACA,OAAOC,GAAP;AACA,OAAO,KAAKC,WAAZ,MAA6B,mBAA7B;AACA,OAAO,KAAKC,QAAZ,MAA0B,eAA1B;AACA,SAASC,UAAT,EAAqBC,UAArB,EAAgCC,sBAAhC,EAAwDC,aAAxD;AACA,SAAQC,kBAAR;AACA,SAASC,YAAT,EAAuBC,MAAvB,QAAqC,mCAArC;AACA,SAASC,iCAAT;AAEA,eAAe,UAASC,cAAT,EAAyB;AAAA,MACjCC,uBADiC;AAAA;;AAAA;;AAGtC,qCAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AAClB,gCAAMA,KAAN;;AADkB,YAWnBC,aAXmB,GAWH,kBAAOC,GAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iDAGOzB,YAAY,CAAC0B,OAAb,CAAqBD,GAArB,CAHP;;AAAA;AAGPE,gBAAAA,KAHO;;AAKb,oBAAIA,KAAK,KAAK,IAAd,EAAoB;AAIrBlB,kBAAAA,KAAK,CAACmB,GAAN,CAAUlB,GAAG,CAACmB,OAAJ,GAAY,aAAtB,EAAoC;AAAEC,oBAAAA,OAAO,EAAE;AAAE,wCAAkBH;AAApB;AAAX,mBAApC,EACCI,IADD,CACM,iBAAOC,GAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAEFA,GAAG,CAACC,MAAJ,KAAe,GAFb;AAAA;AAAA;AAAA;;AAGJ,kCAAKV,KAAL,CAAWW,UAAX,CAAsBC,IAAtB,CAA2B,OAA3B;;AAHI;AAAA;;AAAA;AASAC,4BAAAA,KATA,GASQT,KATR;AAUAU,4BAAAA,cAVA,mBAU8BD,KAV9B;AAAA;AAAA,6DAaiBnB,kBAAkB,EAbnC;;AAAA;AAaAqB,4BAAAA,QAbA;AAcEC,4BAAAA,MAdF,GAcW;AACdC,8BAAAA,GAAG,EAAGF,QAAQ,CAACC,MAAT,CAAgBE,QADR;AAEdC,8BAAAA,GAAG,EAAGJ,QAAQ,CAACC,MAAT,CAAgBI;AAFR,6BAdX;AAmBAC,4BAAAA,SAnBA,GAmBY,IAAI5B,aAAJ,CAAkB,YAAlB,CAnBZ;AAoBJ4B,4BAAAA,SAAS,CAACC,SAAV,CAAoB,eAApB,EAAoC;AAAClB,8BAAAA,KAAK,EAAGS,KAAT;AAAgBC,8BAAAA,cAAc,EAAGA,cAAjC;AAAiDE,8BAAAA,MAAM,EAAGA,MAA1D;AAAkEO,8BAAAA,IAAI,EAAG;AAAzE,6BAApC;AApBI;AAAA,6DAsBE1B,iCAAiC,CAACgB,KAAD,CAtBnC;;AAAA;AAwBJ,kCAAKb,KAAL,CAAWtB,WAAX,CAAuB0B,KAAvB;;AACA,kCAAKJ,KAAL,CAAWrB,cAAX,CAA0ByB,KAA1B;;AACA,kCAAKJ,KAAL,CAAWhB,mBAAX,CAA+B,IAA/B;;AA1BI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADN,EAgCCwC,KAhCD,CAgCO,UAACC,GAAD,EAAO;AACbC,oBAAAA,OAAO,CAACP,GAAR,CAAYM,GAAZ;AACA,mBAlCD;AAmCE,iBAvCD,MAuCO;AACR,wBAAKzB,KAAL,CAAWW,UAAX,CAAsBgB,QAAtB,CAA+B,OAA/B;AAEE;;AA/CY;AAAA;;AAAA;AAAA;AAAA;AAkDbD,gBAAAA,OAAO,CAACP,GAAR;;AAlDa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAXG;;AAAA;AAIlB;;AAPqC;AAAA;AAAA,0CASlB;AACnB,aAAKlB,aAAL,CAAmB,UAAnB;AAEA;AAZqC;AAAA;AAAA,+BAqE1B;AACR,eAAO,oBAAC,cAAD;AAAgB,UAAA,UAAU,EAAE,KAAKD,KAAL,CAAWW,UAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AACA;AAvEkC;;AAAA;AAAA,IACDnC,SADC;;AA0EvC,MAAMoD,eAAe,GAAG,SAAlBA,eAAkB,CAACC,KAAD,EAAW;AAClC,WAAO;AACNC,MAAAA,IAAI,EAAED,KAAK,CAACC,IADN;AAENC,MAAAA,OAAO,EAAEF,KAAK,CAACE,OAFT;AAGNC,MAAAA,QAAQ,EAAEH,KAAK,CAACG,QAHV;AAINC,MAAAA,MAAM,EAAEJ,KAAK,CAACI;AAJR,KAAP;AAMA,GAPD;;AASA,MAAMC,kBAAkB,GAAG;AAC1BxD,IAAAA,WAAW,EAAXA,WAD0B;AAE1BC,IAAAA,cAAc,EAAdA,cAF0B;AAG1BC,IAAAA,cAAc,EAAdA,cAH0B;AAI1BC,IAAAA,eAAe,EAAfA,eAJ0B;AAK1BC,IAAAA,aAAa,EAAbA,aAL0B;AAM1BC,IAAAA,UAAU,EAAVA,UAN0B;AAO1BC,IAAAA,mBAAmB,EAAnBA;AAP0B,GAA3B;AAYA,SAAOC,OAAO,CAAC2C,eAAD,EAAkBM,kBAAlB,CAAP,CAA6CnC,uBAA7C,CAAP;AACA","sourcesContent":["import React, { Component } from 'react';\r\nimport { StyleSheet, Text, View, TextInput, AsyncStorage } from 'react-native';\r\nimport {setUserInfo,mySecondProfil, setContactInfo, setFavoriteInfo, setSecondInfo, onlineUser,setAuthentification} from '../Action'\r\nimport { connect } from \"react-redux\";\r\nimport \taxios from \"axios\";\r\nimport Bdd from '../API/Bdd'\r\nimport * as TaskManager from 'expo-task-manager';\r\nimport * as Location from 'expo-location';\r\nimport { _setSocket, _emitEvent,onSamaritainListChange, SocketService } from '../services/socket';\r\nimport {getCurrentLocation} from \"../services/location\"\r\nimport { faUserCircle, faUser } from '@fortawesome/free-solid-svg-icons';\r\nimport { registerForPushNotificationsAsync } from '../services/notifications';\r\n\r\nexport default function(ChildComponent) {\r\n\tclass RequireAuthentification extends Component {\r\n\r\n\t\tconstructor(props) {\r\n\t\t\tsuper(props);\r\n\t\t\t\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\tcomponentDidMount() {\r\n\t\t\tthis._retrieveData('bosToken');\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\t_retrieveData = async (key) => {\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t  const token = await AsyncStorage.getItem(key);\r\n\t\t\t \r\n\t\t\t  if (token !== null) {\r\n\r\n\t\t\t\t  \r\n\t\t\t\t// We have data!!\r\n\t\t\t\taxios.get(Bdd.api_url+'/checkToken',{ headers: { 'x-access-token': token }} )\r\n\t\t\t\t.then(async (res)=>{\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(res.status !== 200) {\r\n\t\t\t\t\t\tthis.props.navigation.push(\"Login\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet value = token\r\n\t\t\t\t\t\tlet socketListenId =`samaritain_${value}`\r\n\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\tlet location = await getCurrentLocation()\r\n\t\t\t\t\t\tconst coords = {\r\n\t\t\t\t\t\t\tlat : location.coords.latitude,\r\n\t\t\t\t\t\t\tlog : location.coords.longitude\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet socketSrv = new SocketService(\"samaritain\")\r\n\t\t\t\t\t\tsocketSrv.emitEvent(\"status_change\",{token : value, socketListenId : socketListenId, coords : coords, type  :\"join\"})\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tawait registerForPushNotificationsAsync(value)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.props.setUserInfo(token)\r\n\t\t\t\t\t\tthis.props.mySecondProfil(token)\r\n\t\t\t\t\t\tthis.props.setAuthentification(true)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.props.setUserSession(token)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch((err)=>{\r\n\t\t\t\t\tconsole.log(err)\r\n\t\t\t\t})\r\n\t\t\t  } else {\r\n\t\t\t\tthis.props.navigation.navigate(\"Login\");\r\n\t\t\t   \r\n\t\t\t  }\r\n\t\t\t} catch (error) {\r\n\t\t\t  // Error retrieving data\r\n\t\t\t  console.log(error);\r\n\t\t\t}\r\n\t\t  }\r\n\t\t\r\n\r\n\t    render() {\r\n\t    \treturn <ChildComponent navigation={this.props.navigation}/>\r\n\t    }\r\n\t}\r\n\r\n\tconst mapStateToProps = (store) => {\r\n\t\treturn {\r\n\t\t\tuser: store.user,\r\n\t\t\tcontact: store.contact,\r\n\t\t\tfavorite: store.favorite,\r\n\t\t\tsecond: store.second\r\n\t\t}\r\n\t}\r\n\r\n\tconst mapDispatchToProps = {\r\n\t\tsetUserInfo,\r\n\t\tmySecondProfil,\r\n\t\tsetContactInfo,\r\n\t\tsetFavoriteInfo,\r\n\t\tsetSecondInfo,\r\n\t\tonlineUser,\r\n\t\tsetAuthentification\r\n\t}\r\n\r\n\t\r\n\r\n\treturn connect(mapStateToProps, mapDispatchToProps)(RequireAuthentification);\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}