{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"E:\\\\Projets\\\\Acadys\\\\best4sante\\\\SanteV2\\\\assets\\\\Helpers\\\\isAuth.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport { AsyncStorage } from \"react-native-web/dist/index\";\nimport { setUserInfo, mySecondProfil, setContactInfo, setFavoriteInfo, setSecondInfo } from \"../Action\";\nimport { connect } from \"react-redux\";\nimport axios from \"axios\";\nimport Bdd from \"../API/Bdd\";\nimport * as TaskManager from 'expo-task-manager';\nimport * as Location from 'expo-location';\nimport { _setSocket, _emitEvent, onSamaritainListChange, SocketService } from \"../services/socket\";\nimport { getCurrentLocation } from \"../services/location\";\nimport { faUserCircle, faUser } from '@fortawesome/free-solid-svg-icons';\nexport default function (ChildComponent) {\n  var IsAuth = function (_Component) {\n    _inherits(IsAuth, _Component);\n\n    var _super = _createSuper(IsAuth);\n\n    function IsAuth(props) {\n      var _this;\n\n      _classCallCheck(this, IsAuth);\n\n      _this = _super.call(this, props);\n\n      _this._retrieveData = function _callee2(key) {\n        var token;\n        return _regeneratorRuntime.async(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return _regeneratorRuntime.awrap(AsyncStorage.getItem(key));\n\n              case 3:\n                token = _context2.sent;\n\n                if (token !== null) {\n                  axios.get(Bdd.api_url + '/checkToken', {\n                    headers: {\n                      'x-access-token': token\n                    }\n                  }).then(function _callee(res) {\n                    var value, socketListenId, location, coords, socketSrv;\n                    return _regeneratorRuntime.async(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            if (!(res.status !== 200)) {\n                              _context.next = 5;\n                              break;\n                            }\n\n                            _this.props.navigation.push(\"Login\");\n\n                            console.log('status 500');\n                            _context.next = 16;\n                            break;\n\n                          case 5:\n                            value = token;\n                            socketListenId = \"samaritain_\" + value;\n                            _context.next = 9;\n                            return _regeneratorRuntime.awrap(getCurrentLocation());\n\n                          case 9:\n                            location = _context.sent;\n                            coords = {\n                              lat: location.coords.latitude,\n                              log: location.coords.longitude\n                            };\n                            socketSrv = new SocketService(\"samaritain\");\n                            socketSrv.emitEvent(\"status_change\", {\n                              token: value,\n                              socketListenId: socketListenId,\n                              coords: coords,\n                              type: \"join\"\n                            });\n\n                            _this.props.setUserInfo(token);\n\n                            _this.props.mySecondProfil(token);\n\n                            setTimeout(function () {\n                              _this.props.navigation.navigate(\"Menu\");\n                            }, 1500);\n\n                          case 16:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, null, null, null, Promise);\n                  }).catch(function (err) {\n                    console.log(\"eto ilay error, resaka jwt io \", err);\n\n                    _this.props.navigation.push(\"Login\");\n                  });\n                } else {\n                  _this.props.navigation.navigate(\"FirstPage\");\n                }\n\n                _context2.next = 10;\n                break;\n\n              case 7:\n                _context2.prev = 7;\n                _context2.t0 = _context2[\"catch\"](0);\n                console.log(_context2.t0);\n\n              case 10:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, null, null, [[0, 7]], Promise);\n      };\n\n      return _this;\n    }\n\n    _createClass(IsAuth, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        this._retrieveData('bosToken');\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        return React.createElement(ChildComponent, {\n          navigation: this.props.navigation,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 14\n          }\n        });\n      }\n    }]);\n\n    return IsAuth;\n  }(Component);\n\n  var mapStateToProps = function mapStateToProps(store) {\n    return {\n      user: store.user,\n      contact: store.contact,\n      favorite: store.favorite,\n      second: store.second\n    };\n  };\n\n  var mapDispatchToProps = {\n    setUserInfo: setUserInfo,\n    mySecondProfil: mySecondProfil,\n    setContactInfo: setContactInfo,\n    setFavoriteInfo: setFavoriteInfo,\n    setSecondInfo: setSecondInfo\n  };\n  return connect(mapStateToProps, mapDispatchToProps)(IsAuth);\n}","map":{"version":3,"sources":["E:/Projets/Acadys/best4sante/SanteV2/assets/Helpers/isAuth.js"],"names":["React","Component","AsyncStorage","setUserInfo","mySecondProfil","setContactInfo","setFavoriteInfo","setSecondInfo","connect","axios","Bdd","TaskManager","Location","_setSocket","_emitEvent","onSamaritainListChange","SocketService","getCurrentLocation","faUserCircle","faUser","ChildComponent","IsAuth","props","_retrieveData","key","getItem","token","get","api_url","headers","then","res","status","navigation","push","console","log","value","socketListenId","location","coords","lat","latitude","longitude","socketSrv","emitEvent","type","setTimeout","navigate","catch","err","mapStateToProps","store","user","contact","favorite","second","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { StyleSheet, Text, View, TextInput, AsyncStorage } from 'react-native';\r\nimport {setUserInfo,mySecondProfil, setContactInfo, setFavoriteInfo, setSecondInfo} from '../Action'\r\nimport { connect } from \"react-redux\";\r\nimport \taxios from \"axios\";\r\nimport Bdd from '../API/Bdd'\r\nimport * as TaskManager from 'expo-task-manager';\r\nimport * as Location from 'expo-location';\r\nimport { _setSocket, _emitEvent,onSamaritainListChange, SocketService } from '../services/socket';\r\nimport {getCurrentLocation} from \"../services/location\"\r\nimport { faUserCircle, faUser } from '@fortawesome/free-solid-svg-icons';\r\n\r\nexport default function(ChildComponent) {\r\n\tclass IsAuth extends Component {\r\n\r\n\t\tconstructor(props) {\r\n\t\t\tsuper(props);\r\n\t\t\t\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\tcomponentDidMount() {\r\n\t\t\tthis._retrieveData('bosToken');\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\t_retrieveData = async (key) => {\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t  const token = await AsyncStorage.getItem(key);\r\n\t\t\t \r\n\t\t\t  if (token !== null) {\r\n\r\n\t\t\t\t  \r\n\t\t\t\t// We have data!!\r\n\t\t\t\taxios.get(Bdd.api_url+'/checkToken',{ headers: { 'x-access-token': token }} )\r\n\t\t\t\t.then(async (res)=>{\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(res.status !== 200) {\r\n                      this.props.navigation.push(\"Login\");\r\n                        console.log('status 500')\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet value = token\r\n\t\t\t\t\t\tlet socketListenId =`samaritain_${value}`\r\n\r\n\t\t\t\t\t\tlet location = await getCurrentLocation()\r\n\t\t\t\t\t\tconst coords = {\r\n\t\t\t\t\t\t\tlat : location.coords.latitude,\r\n\t\t\t\t\t\t\tlog : location.coords.longitude\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet socketSrv = new SocketService(\"samaritain\")\r\n\t\t\t\t\t\tsocketSrv.emitEvent(\"status_change\",{token : value, socketListenId : socketListenId, coords : coords, type  :\"join\"})\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.props.setUserInfo(token);\r\n\t\t\t\t\t\tthis.props.mySecondProfil(token);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsetTimeout(() =>{\r\n\t\t\t\t\t\t\tthis.props.navigation.navigate(\"Menu\");\r\n\t\t\t\t\t\t},1500)\r\n                        \r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch((err)=>{\r\n\t\t\t\t\tconsole.log(\"eto ilay error, resaka jwt io \",err)\r\n\t\t\t\t\t this.props.navigation.push(\"Login\");\r\n\t\t\t\t})\r\n\t\t\t  } else {\r\n\t\t\t\t// this.props.navigation.navigate(\"Login\");\r\n\t\t\t\tthis.props.navigation.navigate(\"FirstPage\");\r\n\t\t\t\t\r\n\t\t\t  }\r\n\t\t\t} catch (error) {\r\n\t\t\t  // Error retrieving data\r\n\t\t\t  console.log(error);\r\n\t\t\t}\r\n\t\t  }\r\n\t\t\r\n\r\n\t    render() {\r\n\t    \treturn <ChildComponent navigation={this.props.navigation}/>\r\n\t    }\r\n\t}\r\n\r\n\tconst mapStateToProps = (store) => {\r\n\t\treturn {\r\n\t\t\tuser: store.user,\r\n\t\t\tcontact: store.contact,\r\n\t\t\tfavorite: store.favorite,\r\n\t\t\tsecond: store.second\r\n\t\t}\r\n\t}\r\n\r\n\tconst mapDispatchToProps = {\r\n\t\tsetUserInfo,\r\n\t\tmySecondProfil,\r\n\t\tsetContactInfo,\r\n\t\tsetFavoriteInfo,\r\n\t\tsetSecondInfo\r\n\t}\r\n\r\n\t\r\n\r\n\treturn connect(mapStateToProps, mapDispatchToProps)(IsAuth);\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}