{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"C:\\\\Users\\\\Stenny Gabriel\\\\best4sante\\\\Best4Sante\\\\assets\\\\Screens\\\\Emergency.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Linking from \"react-native-web/dist/exports/Linking\";\nimport { connect } from 'react-redux';\nimport axios from 'axios';\nimport TopMenu from \"../component/Menu/TopMenu\";\nimport TabBar from \"@mindinventory/react-native-tab-bar-interaction\";\nimport * as Permissions from 'expo-permissions';\nimport * as Location from 'expo-location';\nimport { emergency } from \"../API/emergency\";\nimport { widthPercentageToDP as wp, heightPercentageToDP as hp } from 'react-native-responsive-screen';\nimport { TouchableOpacity } from 'react-native-gesture-handler';\nimport Bdd from \"../API/Bdd\";\nvar API_KEY = 'AIzaSyApjuz39FHMGBsy9lo7FobJQJtZKNra8P8';\n\nvar Emergency = function (_Component) {\n  _inherits(Emergency, _Component);\n\n  var _super = _createSuper(Emergency);\n\n  function Emergency(props) {\n    var _this;\n\n    _classCallCheck(this, Emergency);\n\n    _this = _super.call(this, props);\n\n    _this.componentDidMount = function _callee() {\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(_this._getCountryCodeByLocation());\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.sendmail = function _callee3(type, msg) {\n      var idUser;\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              idUser = _this.props.user.user.idUser;\n              _context3.next = 3;\n              return _regeneratorRuntime.awrap(axios.post(Bdd.api_url + \"/contact/inform/\" + idUser).then(function _callee2(_) {\n                return _regeneratorRuntime.async(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        console.log(\"ok\");\n\n                      case 1:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, null, null, null, Promise);\n              }));\n\n            case 3:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.callUrgence = function _callee4() {\n      var num, fullname;\n      return _regeneratorRuntime.async(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _regeneratorRuntime.awrap(_this.findNumber());\n\n            case 2:\n              num = _context4.sent;\n\n              _this.callPerson(num.ambulance);\n\n              fullname = _this.props.user.user.data.user[0].firstName + \" \" + _this.props.user.user.data.user[0].lastName;\n              _context4.next = 7;\n              return _regeneratorRuntime.awrap(_this.sendmail('Ambulance', \"Attention ambulance,\" + fullname + \" votre contact d'urgence a déclenché son bouton\"));\n\n            case 7:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.callAccident = function _callee5() {\n      var num, fullname;\n      return _regeneratorRuntime.async(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              num = _this.findNumber();\n\n              _this.callPerson(num.fire);\n\n              fullname = _this.props.user.user.data.user[0].firstName + \" \" + _this.props.user.user.data.user[0].lastName;\n              _context5.next = 5;\n              return _regeneratorRuntime.awrap(_this.sendmail('Accident', \"Attention accident, \" + fullname + \" votre contact d'urgence a déclenché son bouton\"));\n\n            case 5:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.callAgression = function _callee6() {\n      var num, fullname;\n      return _regeneratorRuntime.async(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              num = _this.findNumber();\n\n              _this.callPerson(num.police);\n\n              fullname = _this.props.user.user.data.user[0].firstName + \" \" + _this.props.user.user.data.user[0].lastName;\n              _context6.next = 5;\n              return _regeneratorRuntime.awrap(_this.sendmail('Agression', \"Attention agression, \" + fullname + \" votre contact d'urgence a déclenché son bouton\"));\n\n            case 5:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.findNumber = function _callee7() {\n      var urgence, num;\n      return _regeneratorRuntime.async(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              urgence = _this.state.urgence;\n              num = {\n                ambulance: urgence[0].Ambulance.All[0],\n                fire: urgence[0].Fire.All[0],\n                police: urgence[0].Police.All[0]\n              };\n              return _context7.abrupt(\"return\", num);\n\n            case 3:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this._getCountryCodeByLocation = function _callee9() {\n      var _await$Permissions$as, status, location;\n\n      return _regeneratorRuntime.async(function _callee9$(_context9) {\n        while (1) {\n          switch (_context9.prev = _context9.next) {\n            case 0:\n              _context9.next = 2;\n              return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.LOCATION));\n\n            case 2:\n              _await$Permissions$as = _context9.sent;\n              status = _await$Permissions$as.status;\n\n              if (!(status !== 'granted')) {\n                _context9.next = 8;\n                break;\n              }\n\n              _this.setState({\n                errorMessage: 'Permission to access location was denied'\n              });\n\n              _context9.next = 12;\n              break;\n\n            case 8:\n              _context9.next = 10;\n              return _regeneratorRuntime.awrap(Location.getCurrentPositionAsync({}));\n\n            case 10:\n              location = _context9.sent;\n              axios.get(\"https://maps.googleapis.com/maps/api/geocode/json?latlng=46.5286307,6.5124095&key=\" + API_KEY).then(function _callee8(response) {\n                var globalRes, resObj, local, res;\n                return _regeneratorRuntime.async(function _callee8$(_context8) {\n                  while (1) {\n                    switch (_context8.prev = _context8.next) {\n                      case 0:\n                        globalRes = response.data.results[0].address_components;\n                        _context8.next = 3;\n                        return _regeneratorRuntime.awrap(globalRes.filter(function (el) {\n                          return el.types.includes(\"country\");\n                        }));\n\n                      case 3:\n                        resObj = _context8.sent;\n                        _context8.next = 6;\n                        return _regeneratorRuntime.awrap(resObj[0].short_name);\n\n                      case 6:\n                        local = _context8.sent;\n                        res = emergency.data.filter(function (el) {\n                          return el.Country.ISOCode == local;\n                        });\n\n                        _this.setState({\n                          urgence: res\n                        });\n\n                      case 9:\n                      case \"end\":\n                        return _context8.stop();\n                    }\n                  }\n                }, null, null, null, Promise);\n              }).catch(function (err) {\n                console.log(err);\n              });\n\n            case 12:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    state = {\n      localCode: \"\",\n      urgence: {}\n    };\n    return _this;\n  }\n\n  _createClass(Emergency, [{\n    key: \"callPerson\",\n    value: function callPerson(phone) {\n      var url;\n\n      if (Platform.OS === 'ios') {\n        url = 'tel://' + phone;\n      } else if (Platform.OS === 'android') {\n        url = 'tel:' + phone;\n      }\n\n      Linking.canOpenURL(url).then(function (supported) {\n        if (supported) {\n          return Linking.openURL(url).catch(function () {\n            return null;\n          });\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(TabBar, {\n        bgNavBar: \"white\",\n        bgNavBarSelector: \"white\",\n        stroke: \"skyblue\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 13\n        }\n      }, React.createElement(TabBar.Item, {\n        icon: require(\"../images/accident.png\"),\n        selectedIcon: require(\"../images/accident.png\"),\n        title: \"Tab1\",\n        screenBackgroundColor: {\n          backgroundColor: '#00C1B4'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 17\n        }\n      }, React.createElement(View, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 21\n        }\n      }, React.createElement(View, {\n        style: Platform.OS === 'ios' ? styles.under_ios : styles.under,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 25\n        }\n      }, React.createElement(TopMenu, {\n        navigation: this.props.navigation,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 29\n        }\n      })), React.createElement(View, {\n        style: styles.urgenceContainer,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 25\n        }\n      }, React.createElement(TouchableOpacity, {\n        onPress: function onPress() {\n          return _this2.callAccident();\n        },\n        style: styles.urgenceBtn,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 29\n        }\n      }, React.createElement(Image, {\n        source: require(\"../images/sos.png\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 33\n        }\n      }), React.createElement(Text, {\n        style: styles.legend,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 33\n        }\n      }, \"ACCIDENT\"))))), React.createElement(TabBar.Item, {\n        icon: require(\"../images/malaise.png\"),\n        selectedIcon: require(\"../images/malaise.png\"),\n        title: \"Tab1\",\n        screenBackgroundColor: {\n          backgroundColor: '#00C1B4'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 17\n        }\n      }, React.createElement(View, {\n        style: \"emergencyContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 21\n        }\n      }, React.createElement(View, {\n        style: Platform.OS === 'ios' ? styles.under_ios : styles.under,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 25\n        }\n      }, React.createElement(TopMenu, {\n        navigation: this.props.navigation,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 29\n        }\n      })), React.createElement(View, {\n        style: styles.urgenceContainer,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 25\n        }\n      }, React.createElement(TouchableOpacity, {\n        onPress: function onPress() {\n          return _this2.callUrgence();\n        },\n        style: styles.urgenceBtn,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 29\n        }\n      }, React.createElement(Image, {\n        source: require(\"../images/sos.png\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 29\n        }\n      })), React.createElement(Text, {\n        style: styles.legend,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 29\n        }\n      }, \"MALAISE\")))), React.createElement(TabBar.Item, {\n        icon: require(\"../images/agression.png\"),\n        selectedIcon: require(\"../images/agression.png\"),\n        title: \"Tab1\",\n        screenBackgroundColor: {\n          backgroundColor: '#00C1B4'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 17\n        }\n      }, React.createElement(View, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 21\n        }\n      }, React.createElement(View, {\n        style: Platform.OS === 'ios' ? styles.under_ios : styles.under,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 25\n        }\n      }, React.createElement(TopMenu, {\n        navigation: this.props.navigation,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 29\n        }\n      })), React.createElement(View, {\n        style: styles.urgenceContainer,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 25\n        }\n      }, React.createElement(TouchableOpacity, {\n        onPress: function onPress() {\n          return _this2.callAgression();\n        },\n        style: styles.urgenceBtn,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 25\n        }\n      }, React.createElement(Image, {\n        source: require(\"../images/sos.png\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 29\n        }\n      })), React.createElement(Text, {\n        style: styles.legend,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 29\n        }\n      }, \"AGRESSION\")))));\n    }\n  }]);\n\n  return Emergency;\n}(Component);\n\nvar styles = StyleSheet.create({\n  urgenceContainer: {\n    height: hp(\"65%\"),\n    backgroundColor: \"white\",\n    borderRadius: 50,\n    marginTop: hp(\"3%\")\n  },\n  legend: {\n    fontSize: 25,\n    fontWeight: \"800\",\n    textAlign: \"center\"\n  }\n});\n\nvar mapStateToProps = function mapStateToProps(store) {\n  return {\n    user: store.user,\n    contact: store.contact\n  };\n};\n\nvar mapDispatchToProps = {};\nexport default connect(mapStateToProps, mapDispatchToProps)(Emergency);","map":{"version":3,"sources":["C:/Users/Stenny Gabriel/best4sante/Best4Sante/assets/Screens/Emergency.js"],"names":["React","Component","connect","axios","TopMenu","TabBar","Permissions","Location","emergency","widthPercentageToDP","wp","heightPercentageToDP","hp","TouchableOpacity","Bdd","API_KEY","Emergency","props","componentDidMount","_getCountryCodeByLocation","sendmail","type","msg","idUser","user","post","api_url","then","_","console","log","callUrgence","findNumber","num","callPerson","ambulance","fullname","data","firstName","lastName","callAccident","fire","callAgression","police","urgence","state","Ambulance","All","Fire","Police","askAsync","LOCATION","status","setState","errorMessage","getCurrentPositionAsync","location","get","response","globalRes","results","address_components","filter","el","types","includes","resObj","short_name","local","res","Country","ISOCode","catch","err","localCode","phone","url","Platform","OS","Linking","canOpenURL","supported","openURL","require","backgroundColor","styles","under_ios","under","navigation","urgenceContainer","urgenceBtn","legend","StyleSheet","create","height","borderRadius","marginTop","fontSize","fontWeight","textAlign","mapStateToProps","store","contact","mapDispatchToProps"],"mappings":";;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;;;;;;AAEA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,OAAP;AACA,OAAOC,MAAP,MAAmB,iDAAnB;AACA,OAAO,KAAKC,WAAZ,MAA6B,kBAA7B;AACA,OAAO,KAAKC,QAAZ,MAA0B,eAA1B;AACA,SAASC,SAAT;AACA,SACIC,mBAAmB,IAAIC,EAD3B,EAEIC,oBAAoB,IAAIC,EAF5B,QAGS,gCAHT;AAIA,SAASC,gBAAT,QAAiC,8BAAjC;AACA,OAAOC,GAAP;AACA,IAAMC,OAAO,GAAG,yCAAhB;;IAEMC,S;;;;;AAEF,qBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,8BAAMA,KAAN;;AADe,UAQnBC,iBARmB,GAQC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACZ,MAAKC,yBAAL,EADY;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KARD;;AAAA,UAYnBC,QAZmB,GAYR,kBAAMC,IAAN,EAAWC,GAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAEJC,cAAAA,MAFI,GAEK,MAAKN,KAAL,CAAWO,IAAX,CAAgBA,IAAhB,CAAqBD,MAF1B;AAAA;AAAA,+CAGFpB,KAAK,CAACsB,IAAN,CAAcX,GAAG,CAACY,OAAlB,wBAA4CH,MAA5C,EACJI,IADI,CACC,kBAAMC,CAAN;AAAA;AAAA;AAAA;AAAA;AACFC,wBAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;;AADE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADD,CAHE;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAZQ;;AAAA,UAqBnBC,WArBmB,GAqBL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CAGM,MAAKC,UAAL,EAHN;;AAAA;AAGRC,cAAAA,GAHQ;;AAOV,oBAAKC,UAAL,CAAgBD,GAAG,CAACE,SAApB;;AACIC,cAAAA,QARM,GAQK,MAAKnB,KAAL,CAAWO,IAAX,CAAgBA,IAAhB,CAAqBa,IAArB,CAA0Bb,IAA1B,CAA+B,CAA/B,EAAkCc,SAAlC,GAA4C,GAA5C,GAAgD,MAAKrB,KAAL,CAAWO,IAAX,CAAgBA,IAAhB,CAAqBa,IAArB,CAA0Bb,IAA1B,CAA+B,CAA/B,EAAkCe,QARvF;AAAA;AAAA,+CASJ,MAAKnB,QAAL,CAAc,WAAd,EAA2B,yBAAwBgB,QAAxB,GAAkC,iDAA7D,CATI;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KArBK;;AAAA,UAgCnBI,YAhCmB,GAgCJ;AAAA;AAAA;AAAA;AAAA;AAAA;AACPP,cAAAA,GADO,GACA,MAAKD,UAAL,EADA;;AAEX,oBAAKE,UAAL,CAAgBD,GAAG,CAACQ,IAApB;;AACIL,cAAAA,QAHO,GAGI,MAAKnB,KAAL,CAAWO,IAAX,CAAgBA,IAAhB,CAAqBa,IAArB,CAA0Bb,IAA1B,CAA+B,CAA/B,EAAkCc,SAAlC,GAA4C,GAA5C,GAAgD,MAAKrB,KAAL,CAAWO,IAAX,CAAgBA,IAAhB,CAAqBa,IAArB,CAA0Bb,IAA1B,CAA+B,CAA/B,EAAkCe,QAHtF;AAAA;AAAA,+CAKL,MAAKnB,QAAL,CAAc,UAAd,EAA0B,yBAAwBgB,QAAxB,GAAkC,iDAA5D,CALK;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAhCI;;AAAA,UAwCnBM,aAxCmB,GAwCH;AAAA;AAAA;AAAA;AAAA;AAAA;AACRT,cAAAA,GADQ,GACD,MAAKD,UAAL,EADC;;AAEZ,oBAAKE,UAAL,CAAgBD,GAAG,CAACU,MAApB;;AACIP,cAAAA,QAHQ,GAGG,MAAKnB,KAAL,CAAWO,IAAX,CAAgBA,IAAhB,CAAqBa,IAArB,CAA0Bb,IAA1B,CAA+B,CAA/B,EAAkCc,SAAlC,GAA4C,GAA5C,GAAgD,MAAKrB,KAAL,CAAWO,IAAX,CAAgBA,IAAhB,CAAqBa,IAArB,CAA0Bb,IAA1B,CAA+B,CAA/B,EAAkCe,QAHrF;AAAA;AAAA,+CAKN,MAAKnB,QAAL,CAAc,WAAd,EAA2B,0BAAyBgB,QAAzB,GAAmC,iDAA9D,CALM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAxCG;;AAAA,UAgDnBJ,UAhDmB,GAgDN;AAAA;AAAA;AAAA;AAAA;AAAA;AACLY,cAAAA,OADK,GACK,MAAKC,KAAL,CAAWD,OADhB;AAIHX,cAAAA,GAJG,GAIG;AACRE,gBAAAA,SAAS,EAAGS,OAAO,CAAC,CAAD,CAAP,CAAWE,SAAX,CAAqBC,GAArB,CAAyB,CAAzB,CADJ;AAERN,gBAAAA,IAAI,EAAGG,OAAO,CAAC,CAAD,CAAP,CAAWI,IAAX,CAAgBD,GAAhB,CAAoB,CAApB,CAFC;AAGRJ,gBAAAA,MAAM,EAAGC,OAAO,CAAC,CAAD,CAAP,CAAWK,MAAX,CAAkBF,GAAlB,CAAsB,CAAtB;AAHD,eAJH;AAAA,gDASFd,GATE;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAhDM;;AAAA,UAiFnBd,yBAjFmB,GAiFS;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACDb,WAAW,CAAC4C,QAAZ,CAAqB5C,WAAW,CAAC6C,QAAjC,CADC;;AAAA;AAAA;AAClBC,cAAAA,MADkB,yBAClBA,MADkB;;AAAA,oBAEpBA,MAAM,KAAK,SAFS;AAAA;AAAA;AAAA;;AAGpB,oBAAKC,QAAL,CAAc;AACVC,gBAAAA,YAAY,EAAE;AADJ,eAAd;;AAHoB;AAAA;;AAAA;AAAA;AAAA,+CAOC/C,QAAQ,CAACgD,uBAAT,CAAiC,EAAjC,CAPD;;AAAA;AAOhBC,cAAAA,QAPgB;AAUpBrD,cAAAA,KAAK,CAACsD,GAAN,CAAU,uFAAuF1C,OAAjG,EAGCY,IAHD,CAGM,kBAAM+B,QAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACIC,wBAAAA,SADJ,GACgBD,QAAQ,CAACrB,IAAT,CAAcuB,OAAd,CAAsB,CAAtB,EAAyBC,kBADzC;AAAA;AAAA,yDAGiBF,SAAS,CAACG,MAAV,CAAiB,UAAAC,EAAE,EAAI;AACtC,iCAAOA,EAAE,CAACC,KAAH,CAASC,QAAT,CAAkB,SAAlB,CAAP;AACH,yBAFkB,CAHjB;;AAAA;AAGEC,wBAAAA,MAHF;AAAA;AAAA,yDAMkBA,MAAM,CAAC,CAAD,CAAN,CAAUC,UAN5B;;AAAA;AAMIC,wBAAAA,KANJ;AAOCC,wBAAAA,GAPD,GAOM7D,SAAS,CAAC6B,IAAV,CAAeyB,MAAf,CAAsB,UAAAC,EAAE,EAAG;AAChC,iCAAOA,EAAE,CAACO,OAAH,CAAWC,OAAX,IAAsBH,KAA7B;AACH,yBAFQ,CAPN;;AAWH,8BAAKf,QAAL,CAAc;AACVT,0BAAAA,OAAO,EAAGyB;AADA,yBAAd;;AAXG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAHN,EAqBCG,KArBD,CAqBO,UAAAC,GAAG,EAAG;AACT5C,gBAAAA,OAAO,CAACC,GAAR,CAAY2C,GAAZ;AACH,eAvBD;;AAVoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAjFT;;AAEf5B,IAAAA,KAAK,GAAG;AACJ6B,MAAAA,SAAS,EAAE,EADP;AAEJ9B,MAAAA,OAAO,EAAE;AAFL,KAAR;AAFe;AAMlB;;;;+BAsDU+B,K,EAAM;AACb,UAAIC,GAAJ;;AACA,UAAGC,QAAQ,CAACC,EAAT,KAAgB,KAAnB,EAA0B;AACxBF,QAAAA,GAAG,GAAI,WAASD,KAAhB;AACD,OAFD,MAGK,IAAGE,QAAQ,CAACC,EAAT,KAAgB,SAAnB,EAA8B;AAC/BF,QAAAA,GAAG,GAAG,SAAOD,KAAb;AAEH;;AAEDI,MAAAA,OAAO,CAACC,UAAR,CAAmBJ,GAAnB,EACGjD,IADH,CACQ,UAACsD,SAAD,EAAe;AACnB,YAAIA,SAAJ,EAAe;AACb,iBAAOF,OAAO,CAACG,OAAR,CAAgBN,GAAhB,EACJJ,KADI,CACE;AAAA,mBAAM,IAAN;AAAA,WADF,CAAP;AAED;AACF,OANH;AAQH;;;6BA0CQ;AAAA;;AAGL,aAEI,oBAAC,MAAD;AAAQ,QAAA,QAAQ,EAAC,OAAjB;AAAyB,QAAA,gBAAgB,EAAC,OAA1C;AAAkD,QAAA,MAAM,EAAC,SAAzD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAEI,oBAAC,MAAD,CAAQ,IAAR;AAEI,QAAA,IAAI,EAAEW,OAAO,0BAFjB;AAGI,QAAA,YAAY,EAAEA,OAAO,0BAHzB;AAII,QAAA,KAAK,EAAC,MAJV;AAKI,QAAA,qBAAqB,EAAE;AAAEC,UAAAA,eAAe,EAAE;AAAnB,SAL3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAOI,oBAAC,IAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAEP,QAAQ,CAACC,EAAT,KAAgB,KAAhB,GAAwBO,MAAM,CAACC,SAA/B,GAA2CD,MAAM,CAACE,KAA/D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,OAAD;AAAS,QAAA,UAAU,EAAE,KAAKtE,KAAL,CAAWuE,UAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CADJ,EAII,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAEH,MAAM,CAACI,gBAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,gBAAD;AAAkB,QAAA,OAAO,EAAE;AAAA,iBAAK,MAAI,CAACjD,YAAL,EAAL;AAAA,SAA3B;AAAqD,QAAA,KAAK,EAAE6C,MAAM,CAACK,UAAnE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,KAAD;AAAO,QAAA,MAAM,EAAEP,OAAO,qBAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,EAEI,oBAAC,IAAD;AAAO,QAAA,KAAK,EAAEE,MAAM,CAACM,MAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAFJ,CADJ,CAJJ,CAPJ,CAFJ,EAuBI,oBAAC,MAAD,CAAQ,IAAR;AAEI,QAAA,IAAI,EAAER,OAAO,yBAFjB;AAGI,QAAA,YAAY,EAAEA,OAAO,yBAHzB;AAII,QAAA,KAAK,EAAC,MAJV;AAKI,QAAA,qBAAqB,EAAE;AAAEC,UAAAA,eAAe,EAAE;AAAnB,SAL3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAOI,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAC,oBAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAEP,QAAQ,CAACC,EAAT,KAAgB,KAAhB,GAAwBO,MAAM,CAACC,SAA/B,GAA2CD,MAAM,CAACE,KAA/D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,OAAD;AAAS,QAAA,UAAU,EAAE,KAAKtE,KAAL,CAAWuE,UAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CADJ,EAII,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAEH,MAAM,CAACI,gBAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,gBAAD;AAAkB,QAAA,OAAO,EAAE;AAAA,iBAAK,MAAI,CAAC1D,WAAL,EAAL;AAAA,SAA3B;AAAoD,QAAA,KAAK,EAAEsD,MAAM,CAACK,UAAlE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACA,oBAAC,KAAD;AAAO,QAAA,MAAM,EAAEP,OAAO,qBAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADA,CADJ,EAII,oBAAC,IAAD;AAAO,QAAA,KAAK,EAAEE,MAAM,CAACM,MAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAJJ,CAJJ,CAPJ,CAvBJ,EA4CI,oBAAC,MAAD,CAAQ,IAAR;AAEI,QAAA,IAAI,EAAER,OAAO,2BAFjB;AAGI,QAAA,YAAY,EAAEA,OAAO,2BAHzB;AAII,QAAA,KAAK,EAAC,MAJV;AAKI,QAAA,qBAAqB,EAAE;AAAEC,UAAAA,eAAe,EAAE;AAAnB,SAL3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAOI,oBAAC,IAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAEP,QAAQ,CAACC,EAAT,KAAgB,KAAhB,GAAwBO,MAAM,CAACC,SAA/B,GAA2CD,MAAM,CAACE,KAA/D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,OAAD;AAAS,QAAA,UAAU,EAAE,KAAKtE,KAAL,CAAWuE,UAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CADJ,EAII,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAEH,MAAM,CAACI,gBAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACA,oBAAC,gBAAD;AAAkB,QAAA,OAAO,EAAE;AAAA,iBAAK,MAAI,CAAC/C,aAAL,EAAL;AAAA,SAA3B;AAAsD,QAAA,KAAK,EAAE2C,MAAM,CAACK,UAApE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,KAAD;AAAO,QAAA,MAAM,EAAEP,OAAO,qBAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CADA,EAII,oBAAC,IAAD;AAAO,QAAA,KAAK,EAAEE,MAAM,CAACM,MAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAJJ,CAJJ,CAPJ,CA5CJ,CAFJ;AAsEH;;;;EAnMmB1F,S;;AAsMxB,IAAMoF,MAAM,GAAGO,UAAU,CAACC,MAAX,CAAkB;AAC7BJ,EAAAA,gBAAgB,EAAG;AACfK,IAAAA,MAAM,EAAGlF,EAAE,CAAC,KAAD,CADI;AAEfwE,IAAAA,eAAe,EAAG,OAFH;AAGfW,IAAAA,YAAY,EAAG,EAHA;AAIfC,IAAAA,SAAS,EAAGpF,EAAE,CAAC,IAAD;AAJC,GADU;AAO7B+E,EAAAA,MAAM,EAAG;AACLM,IAAAA,QAAQ,EAAG,EADN;AAELC,IAAAA,UAAU,EAAG,KAFR;AAGLC,IAAAA,SAAS,EAAG;AAHP;AAPoB,CAAlB,CAAf;;AAcA,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAACC,KAAD,EAAW;AAC/B,SAAO;AACH7E,IAAAA,IAAI,EAAE6E,KAAK,CAAC7E,IADT;AAEH8E,IAAAA,OAAO,EAAED,KAAK,CAACC;AAFZ,GAAP;AAIH,CALD;;AAOA,IAAMC,kBAAkB,GAAG,EAA3B;AAGA,eAAerG,OAAO,CAACkG,eAAD,EAAkBG,kBAAlB,CAAP,CAA6CvF,SAA7C,CAAf","sourcesContent":["import React, { Component } from 'react'\r\nimport { Text, View, StyleSheet,Image,Linking } from 'react-native'\r\nimport { connect } from 'react-redux'\r\nimport axios from 'axios'\r\nimport TopMenu from \"../component/Menu/TopMenu\"\r\nimport TabBar from \"@mindinventory/react-native-tab-bar-interaction\";\r\nimport * as Permissions from 'expo-permissions';\r\nimport * as Location from 'expo-location';\r\nimport { emergency } from \"../API/emergency\";\r\nimport {\r\n    widthPercentageToDP as wp,\r\n    heightPercentageToDP as hp,\r\n  } from 'react-native-responsive-screen'\r\nimport { TouchableOpacity } from 'react-native-gesture-handler'\r\nimport Bdd from \"../API/Bdd\"\r\nconst API_KEY = 'AIzaSyApjuz39FHMGBsy9lo7FobJQJtZKNra8P8';\r\n\r\nclass Emergency extends Component {\r\n   \r\n    constructor(props) {\r\n        super(props)\r\n        state = {\r\n            localCode: \"\",\r\n            urgence: {}\r\n        }\r\n    }\r\n\r\n    componentDidMount = async ()  =>{\r\n      await this._getCountryCodeByLocation()\r\n    }\r\n\r\n    sendmail = async(type,msg)=>{\r\n        \r\n       let idUser = this.props.user.user.idUser\r\n       await axios.post(`${Bdd.api_url}/contact/inform/${idUser}`)\r\n        .then(async _=>{\r\n            console.log(\"ok\")\r\n        })\r\n    }\r\n\r\n    callUrgence = async () =>{\r\n      \r\n      \r\n      let num = await   this.findNumber()\r\n\r\n       \r\n        \r\n        this.callPerson(num.ambulance)  \r\n        let fullname = this.props.user.user.data.user[0].firstName+\" \"+this.props.user.user.data.user[0].lastName\r\n        await this.sendmail('Ambulance', \"Attention ambulance,\" +fullname+ \" votre contact d'urgence a déclenché son bouton\")  \r\n    }\r\n    callAccident = async () =>{\r\n        let num =  this.findNumber()\r\n        this.callPerson(num.fire)\r\n        let fullname = this.props.user.user.data.user[0].firstName+\" \"+this.props.user.user.data.user[0].lastName\r\n\r\n        await this.sendmail('Accident', \"Attention accident, \" +fullname+ \" votre contact d'urgence a déclenché son bouton\") \r\n    }\r\n\r\n    callAgression = async () =>{\r\n        let num =  this.findNumber()\r\n        this.callPerson(num.police)\r\n        let fullname = this.props.user.user.data.user[0].firstName+\" \"+this.props.user.user.data.user[0].lastName\r\n\r\n        await this.sendmail('Agression', \"Attention agression, \" +fullname+ \" votre contact d'urgence a déclenché son bouton\") \r\n    }\r\n\r\n    findNumber = async  () =>{\r\n        let urgence = this.state.urgence\r\n\r\n\r\n        const num = {\r\n            ambulance : urgence[0].Ambulance.All[0],\r\n            fire : urgence[0].Fire.All[0],\r\n            police : urgence[0].Police.All[0]\r\n        }\r\n        return num\r\n    }\r\n\r\n    callPerson(phone){\r\n        let url;\r\n        if(Platform.OS === 'ios') {\r\n          url  = 'tel://'+phone\r\n        }\r\n        else if(Platform.OS === 'android') {\r\n            url = 'tel:'+phone\r\n            \r\n        }\r\n    \r\n        Linking.canOpenURL(url)\r\n          .then((supported) => {\r\n            if (supported) {\r\n              return Linking.openURL(url)\r\n                .catch(() => null);\r\n            }\r\n          });\r\n        \r\n    }\r\n    \r\n   \r\n    _getCountryCodeByLocation = async () => {\r\n        let { status } = await Permissions.askAsync(Permissions.LOCATION);\r\n        if (status !== 'granted') {\r\n            this.setState({\r\n                errorMessage: 'Permission to access location was denied',\r\n            });\r\n        }else{\r\n            let location = await Location.getCurrentPositionAsync({});\r\n        \r\n\r\n            axios.get(\"https://maps.googleapis.com/maps/api/geocode/json?latlng=46.5286307,6.5124095&key=\" + API_KEY)\r\n\r\n      //  axios.get(\"https://maps.googleapis.com/maps/api/geocode/json?latlng=\" + location.coords.latitude + \",\" + location.coords.longitude + \"&key=\" + API_KEY)\r\n            .then(async response => {\r\n                const globalRes = response.data.results[0].address_components\r\n               \r\n                let resObj = await globalRes.filter(el => {\r\n                    return el.types.includes(\"country\")\r\n                })\r\n                const local = await resObj[0].short_name\r\n               let res= emergency.data.filter(el =>{\r\n                   return el.Country.ISOCode == local\r\n               })\r\n\r\n               this.setState({\r\n                   urgence : res\r\n               })\r\n\r\n\r\n\r\n            })\r\n            .catch(err =>{\r\n                console.log(err)\r\n            })\r\n        }\r\n\r\n        \r\n\r\n    };\r\n    render() {\r\n\r\n\r\n        return (\r\n\r\n            <TabBar bgNavBar=\"white\" bgNavBarSelector=\"white\" stroke=\"skyblue\">\r\n\r\n                <TabBar.Item\r\n\r\n                    icon={require(`../images/accident.png`)}\r\n                    selectedIcon={require(`../images/accident.png`)}\r\n                    title=\"Tab1\"\r\n                    screenBackgroundColor={{ backgroundColor: '#00C1B4' }}\r\n                >\r\n                    <View>\r\n                        <View style={Platform.OS === 'ios' ? styles.under_ios : styles.under}>\r\n                            <TopMenu navigation={this.props.navigation} />\r\n                        </View>\r\n                        <View style={styles.urgenceContainer}>\r\n                            <TouchableOpacity onPress={()=> this.callAccident()} style={styles.urgenceBtn}>\r\n                                <Image source={require(\"../images/sos.png\")} />\r\n                                <Text  style={styles.legend}>ACCIDENT</Text>\r\n                            </TouchableOpacity>\r\n                            \r\n                        </View>\r\n                    </View>\r\n                </TabBar.Item>\r\n\r\n                <TabBar.Item\r\n\r\n                    icon={require(`../images/malaise.png`)}\r\n                    selectedIcon={require(`../images/malaise.png`)}\r\n                    title=\"Tab1\"\r\n                    screenBackgroundColor={{ backgroundColor: '#00C1B4' }}\r\n                >\r\n                    <View style=\"emergencyContainer\">\r\n                        <View style={Platform.OS === 'ios' ? styles.under_ios : styles.under}>\r\n                            <TopMenu navigation={this.props.navigation} />\r\n                        </View>\r\n                        <View style={styles.urgenceContainer}>\r\n                            <TouchableOpacity onPress={()=> this.callUrgence()} style={styles.urgenceBtn}>\r\n                            <Image source={require(\"../images/sos.png\")} />\r\n                            </TouchableOpacity>\r\n                            <Text  style={styles.legend}>MALAISE</Text>\r\n                        </View>\r\n                        \r\n                    </View>\r\n                </TabBar.Item>\r\n\r\n                <TabBar.Item\r\n\r\n                    icon={require(`../images/agression.png`)}\r\n                    selectedIcon={require(`../images/agression.png`)}\r\n                    title=\"Tab1\"\r\n                    screenBackgroundColor={{ backgroundColor: '#00C1B4' }}\r\n                >\r\n                    <View>\r\n                        <View style={Platform.OS === 'ios' ? styles.under_ios : styles.under}>\r\n                            <TopMenu navigation={this.props.navigation} />\r\n                        </View>\r\n                        <View style={styles.urgenceContainer}>\r\n                        <TouchableOpacity onPress={()=> this.callAgression()} style={styles.urgenceBtn}>\r\n                            <Image source={require(\"../images/sos.png\")} />\r\n                            </TouchableOpacity>\r\n                            <Text  style={styles.legend}>AGRESSION</Text>\r\n                            \r\n                        </View>\r\n                    </View>\r\n                </TabBar.Item>\r\n\r\n            </TabBar>\r\n\r\n        )\r\n    }\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    urgenceContainer : {\r\n        height : hp(\"65%\"),\r\n        backgroundColor : \"white\",\r\n        borderRadius : 50,\r\n        marginTop : hp(\"3%\")\r\n    },\r\n    legend : {\r\n        fontSize : 25,\r\n        fontWeight : \"800\",\r\n        textAlign : \"center\"\r\n    }\r\n})\r\n\r\nconst mapStateToProps = (store) => {\r\n    return {\r\n        user: store.user,\r\n        contact: store.contact\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n\r\n}\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Emergency)\r\n\r\n"]},"metadata":{},"sourceType":"module"}